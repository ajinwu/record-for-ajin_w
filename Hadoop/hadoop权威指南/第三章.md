<!--
 * Author       : ajin
 * Date         : 2020-02-25 17:11:24
 * Description  : 
 * email        : ajin_w@163.com
 * ajin是最好的人啦
 -->


## HDFS的块大小设定
1. 默认为128MB, 同时为了容忍数据丢失,会进行备份机制
2. 块大小可以改变, 设置块大小较大是为了减小寻址时间,从而提高整体速度
3. 块大小可以大于网络中任意一个磁盘的大小, 单个文件的块可以不存储在同一个磁盘上
4. 简化了设计, 元数据分块处理, 元数据信息存储在namenode上面


## namenode和datanode
1. namenode管理文件系统的命令空间, 维护文件树和树内的文件
2. namenode永久保存的文件, 命令空间镜像文件和编辑日志文件
3. namenode记录着每个块的结点信息,但是在系统重启时会重建结点信息
4. datanode存储和检索数据块, 并定期向namenode发送块列表

namenode故障修复
1. 设置单一一个nfs用来保存nm的元数据持久化信息
2. 辅助nm, 用来合并编辑日志和镜像文件


块缓存,在一些小的数据或者频繁读取的数据来说, 将数据缓存在堆外可以加快读取效率(小表连接大表)

联邦HDFS, 一个目录由一个namenode来负责,可以减轻namenode的压力,nm命名空间是隔离的,一个nm失效也不会影响另一个nm

## HA
1. 设置备份nm,通过共享存储来实现编辑日志的共享, 当新的nm接管后,读取编辑文件并处理新的请求
2. dn需要向多个nm发送块信息
3. 2nn的角色被nm包含, 备用nm为活动的nm设置周期性检查结点

## QJM集群
1. 他提供一种高可用编辑日志,每一次编辑都需要写入多数日志节点
2. 同一时间QIM只允许向一个nm写入日志

## 数据访问方式
HTTP访问,一种是使用nm内嵌的web服务器作为webDFS的端节点运行, 文件元数据由nm管理,读写操作会先发往nm,在重定向到dn,第二种是通过代理服务器, 客户端不直接访问nm,可以设置更严格的防火墙策略,可以实现在不同数据中心的数据传输


## 管线以及副本放置
1. 在删除或者写入文件时,写入数据包的内部队列,datastreamer处理数据队列,挑选出合适的dn来存储数据,这一组dn构成一条管线,接收端还有确认队列,写入故障通常会先关闭管线,然后给正常的dn一个标识,便于在恢复后删除数据
2. 副本放置会采用负载均衡

## 数据强行刷新到dn
1. hflush, 只会刷新到dn的内存中
2. hsync, 会强制写入磁盘

distcp可以并行复制文件
