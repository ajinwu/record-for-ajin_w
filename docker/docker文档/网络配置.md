# 网络概览

## 网络设备
docker网络有六种设备, 对于不同的情景使用最优的设备是最好的选择
1. bridge: 桥接网络, 是容器的默认网络, 桥接网络是经常使用在独立容器应用中, 用来通信的网络
2. host: 对于独立的容器, 去掉容器和主机之间的网络隔离, 使用主机网络转发, host网络仅可以使用在高于17.06的swarm服务中
3. overlay: overlay网络连接不同的docker daemon守护进程, 并且开启swarm服务在每一个docker daemon中通信, 能够使用overlay网络在不同的swarm服务和不同或者相同独立的容器中进行通信, 这个技术消除了操作系统级别的网络需求
4. macvlan: 虚拟地址网络允许给容器设置mac地址, 使其作为网络上的物理设备来使用, docker daemon将根据容器的mac地址将流量路由转发到容器
5. none: 对于这个容器, 禁用网络, 通常与自定义网络一起使用
6. 网络插件: 查看dockerhub或者第三方提供商

## 网络选择
1. 桥接网络在同一个主机上的不同容器间进行通信中使用
2. 主机网路在需要不适用docker网络, 但是需要使用容器时使用(直接使用内网或者公网使用)
3. overlay网路在不同的docker主机中进行通信, 或者不同网络应用网络均使用swarm服务
4. macvlan网络在迁移容器到其他物理主机使用,使用唯一的mac地址
5. 第三方网络

## docker EE features
1. 相同网络上使用不同的服务, 根据客户机的需求, UCP路由转发到合适的服务上
2. 对于需要有状态会话的应用程序，会话粘性允许您在HTTP标头中指定UCP用于将后续请求路由到相同服务任务的信息。(机翻)

# 使用桥接网络
桥接网络是链路层设备, 在不同的网络段中转发流量, docker允许连接同一个桥接网络的容器进行通信, 同时隔离没有与桥接网络连接的容器

## 用户自定义网桥和默认网桥的区别
1. 用户自定义的网路在不同的容器间提供了更好的隔离性与互操作性

容器连接一个桥接网络自动暴露所有的端口对于连接同一个桥接网络, 所有的端口都不暴露出去, 这样使得容器很容易进行通信


2. 用户自定义网桥提供了在不同容器间自动dns解析

容器使用的默认桥接网络只能使用ip地址访问, 除非使用`--link` 选项, 在用户自定义网络中, 容器可使用别名进行互相解析, 对于很多的容器会增加复杂性, 或者使用hosts也会带来不可以预估的错误

3. 可以动态在用户自定义网段中删除或者添加容器
4. 每一个自定义网段都可以创建配置

对于使用默认网桥来说, 所有的容器使用一套配置, 重新配置后需要重启docker, 但是用自定义网桥, 可以创建不同的网络配置来满足需求

5. 连接默认容器来共享环境变量

起初只有使用了`--like`连接了不同容器才能共享环境变量, 但是还有其他方案
   1. 不同容器挂载同一个文件或者目录
   2. 使用docker-compose
   3. swarm


## 管理用户自定义网络
docker create network --help


## 正在运行中的容器进行网络切换
``` docker
docker network connect mybr0 my-nginx
docker network disconnect my-net my-nginx
```

## ipv6支持
需要手动开启,创建是加上`--ipv6`来开启, 但是不能选择在支持ipv6的网桥上禁用