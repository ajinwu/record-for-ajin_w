<!--
 * Author       : ajin
 * Date         : 2020-03-06 14:44:15
 * Description  : 
 * email        : ajin_w@163.com
 * 那曾梦想屠龙的少年，终会变成油腻的中年大叔，端坐于显示器前，从指尖流淌的代码，终会改变整个世界
 -->

词法分析的意义: 
1. 规定单词形成的规则,也称构词规则或词法规则, 相当于立法, 规定什么样的输入序列是语言允许的合法单词
2. 根据构词规则识别输入序列, 也称为词法分析, 相当于执法, 规定根据规则识别出合法的单词并指出非法的输入序列

## 词法分析中的问题
1. 记号, 模式, 单词:产生和识别单词的规则称为模式, 按照模式识别出来的元素称为记号, 而单词指被识别出的元素自身的值, 词法分析器识别出的序列称为记号流

2. 记号的属性: 记号包括记号类别和记号的其他信息(如num(1,2), 记号类别是num, 记号的其他信息是1,2等)

3. 词法分析器的作用和工作方式, 可以认为是整个编译器的预处理器
    1. 过滤掉注释, 空格, 回车等无用的东西
    2. 处理与具体平台有关的输入
    3. 识别记号, 并交给语法分析器
    4. 调用符号管理器和出错管理器

    词法分析器的工作方式

    1. 词法分析器作为语法分析器的子程序, 在语法分析器需要一个记号时, 词法分析器给出一个记号
    2. 词法分析器单独一遍扫描, 输出是以记号流形式表示的源程序
    3. 同时并行工作, 用队列将词法分析器的内容交给语法分析器
4. 输入缓冲区
    1. 词法分析器极消耗时间, 使用缓冲区来加快速度
    2. 一般设计为磁盘扇区倍数大小的内存
    3. 双指针行进方式

## 模式的形式化描述
1. 字符串和语言, 程序设计语言就是一个正规集
2. 正规式和正规集, 运算的优先级高=>低: 闭包运算, 连接运算, 或运算
    1. 正规集是一个集合, 正规式是表示正规集的一种方法 
    2. 语言L是有限字母集上的有限长度字符集合(语言是一个集合,集合中的元素是字符串, 并且两个有限)
    3. 令E是一个有限字母表,则E上的正规式及其表示的集合定义
        1. e是正规式, 则表示集合L(e) = {e}
        2. 若a是E上的字符, 则a是正规式, 表示集合L(a) = {a}
        3. 若正规式r,s表示集合L(r)和L(s) 
            1. r|s是正规式, 表示集合L(s) U L(r)
            2. rs是正规式, 表示集合L(s)L(r)
            3. r*是正规式, 表示集合L(r)\*
            4. (r)是正规式, 表示集合L(r) 
        4. 有左结合性质
    4. 正规式具有代数性质
3. 记号的说明: 正规式是严格的数学表达式, 精准表达, 用正规式说明的记号是一个正规集
    1. 简化正规式描述: 正闭包(r+), 可缺省(r? = r | e), 字符组([abc]=a|b|c, ), 非字符组, 串
    2. 引入辅助定义式, 辅助式仍是正规式, 唯一的区别是正规式与外部模式匹配, 而辅助式不是, 例如char = [a-z]

## 有限自动机
1. 不确定有限自动机NFA
    1. NFA是一个五元组M = (S, E, move, s0, F)
    2. S是有限个状态的集合, E是有限个输入字符(包括e)
    3. move是一个状态转移函数, move(si, ch) = sj,表示当前状态si下输入字符ch则转移到sj状态
    4. s0是唯一的初态
    5. F是最终状态集是S的子集, 包含了所有的状态
2. NFA的特点在于他的不确定性, 在当前状态下, 可能有多余一个的状态转移, move函数是一对多的
3. 问题:
    1. 只有尝试了所有的可能路径才能确定一个输入序列, 而路径的条数随着路径的长度指数增长
    2. 识别过程有大量回溯, 时间复杂度与输入序列指数级增长, 且算法复杂


4. 确定的有限状态机DFA
    1. move函数是一对一的
5. 自动机的状态数是确定的, 若有限自动机M和M'识别同一个正规集, 则称M和M'是等价的, 对于任何一个NFA, 都可以找到一个与他等价的DFA

## 从正规式到词法分析器
构造词法分析器的一般步骤

1. 用正规式对模式进行描述
2. 为每一个正规式构造一个NFA, 他识别所有正规式的正规集
3. 将构造的NFA转化为DFA, 称之为确定化
4. 优化DFA, 使其状态数最小, 称为最小化
5. 根据DFA构造词法分析器

thomspon算法构造NFA

DFA|NFA|区别
---|---|---
初态|初态集|从初态转化为初态集
下一状态|下一状态集|从下一状态转化为状态集
s in F|s交集F != 空|从输入序列被接受的条件是否是终态集中的一个状态变为判断最后一个状态集与终态集是否为空集

状态集的定义如下

1. T中的所有状态都属于e_闭包(T)
2. 任何smove(e_闭包(T))也属于e_闭包(T), 经过e状态所到达的下一状态也在闭包之中
3. 再无任何其他状态属于e_闭包(T), 由T出发经e所能到达的全体


子集法构造DFA, 预先将NFA的路径确定化, 并且记录下来, 形成与NFA等价的DFA, 而对记号的识别在DFA上进行, 以提高效率

最小化DFA

接受相同的正规集的DFA认为是等价的, 但是其状态不一定相同, 对于若干个等价的DFA, 总希望使用状态数最小的DFA来构造词法分析器, 讲一个DFA等价变换为另一个状态最小的DFA称为最小化

可区分与不可区分, 不可区分的状态可以合并为一个装态, 不可区分指, 任何输入序列均得到相同结果

最小化DFA状态数

1. 初始划分, 将所有状态按照终态和非终态来区分
2. 利用可区分概念进行分裂
3. 由最终划分构造D', 关键是选代表和修改状态转移

### 由DFA构造词法分析器
1. 表驱动型词法分析器
2. 直接编码型词法分析器

两者的工作原理完全相同, 基本依据都是DFA, 表驱动型分析器的驱动器仅对分析标的内容进行操作,与所识别的记号无关,识别的记号与分析表中与模式密切相关的数据来控制,是一种数据与操作分离的工作模式,构造不同的词法分析器实质就是构造不同的分析表, 直接编码型是通过程序的流程控制转移来完成对输出字符串的响应, 程序的每一条语句都与模式相关, 一旦模式改变, 程序必须改变
