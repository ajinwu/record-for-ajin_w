# 进程的描述和控制

## 1. 前趋图和程序执行

   1. 前趋图

   2. 程序的顺序执行
     1. 程序顺序执行：一个应用程序有若干程序段组成，每一个程序完成指定功能，他们按照某种次序执行
     2. 特征
        - 顺序性：处理机严格按照程序规定的顺序执行
        - 封闭性：程序在封闭的环境下运行，即程序完全独占资源，资源的状态只有本程序才能改变他，程序一旦开始执行，执行结果不受外界影响
        - 可在现性：只要程序执行时的环境和条件相同，当程序重复执行时都可以获得相同的结果

   3. 程序并发执行
     1. 程序并发执行：一段时间执行多个任务
     2. 特征：
        1. 间断性，程序在并发执行时，由于共享资源，为完成同一项任务相互合作形成相互制约关系
        2. 失去封闭性, 当系统存在多个可并发执行程序时，系统各种资源为其所共享，二这些资源资源状态也有这些程序来改变
        3. 不可再现行，程序在并发执行时，失去了封闭性，也导致失去可在现性

## 2. 进程的描述

1. 进程的定义和特征
   1. 进程的定义
        1. 进程是程序的一次执行
        2. 进程是一个程序及其数据在处理机上顺序执行所发生的活动
        3. 进程是具有独立功能的程序在一个数据集合上运行的过程，他是系统进行资源分配和调度的一个单位
   2. 进程的特征, 进程和程序是两个不同的概念
        1. 动态性
        2. 并发性
        3. 独立性
        4. 异步性
2. 进程的基本状态及转换
3. 进程的三种基本状态，由于多个进程在并发执行时共享系统资源，致使他们在运行过程中呈现间断性运行规律，所以进程在生命周期内多个状态，一般有三个状态 
   1. 就绪状态
   2. 执行状态
   3. 阻塞状态
   
4. 创建状态和终止状态
   
   1. 创建状态，分配资源	

   2. 终止状态，回收资源
   3. 挂起操作和进程状态的转换

   1. 挂起操作的引入
   - 终端用户需要
      - 父进程需求
      - 负载调节的需要
      - 操作系统的需要
   - 进程管理中的数据结构
   1. 操作系统中用于管理控制的数据结构，计算机系统中对于每个资源和每个进程都设置了一个数据结构，用于表征实体，我们称之为资源信息表或者进程信息表
   2. 进程控制块PCB的作用
      - 作为独立运行基本单位的标志
      - 能实现间断性运行方式
      - 能提供进程管理所需要的信息
      - 提供进程调度所需要的信息
      - 实现与其他进程的同步与通信
   3. 进程控制块的信息
      - 进程标识符，用于唯一标识一个进程，一个进程通常有外部标识符（父子）和内部标识符（pid）
      - 处理机状态称为处理机上下文，主要是处理机的各种寄存器中的内容组成，通用寄存器和指令寄存器
      - 进程调度信息，进程当前状态，进程优先级，进程调度需要的其他方法(调度算法)，事件（进程有执行状态转变为阻塞状态所等待发生的事件，即阻塞原因）
      - 进程控制信息，用于进程控制必须的信息，程序和数据的地址，进程实体中的程序和数据内存或外村地址。进程同步和通信机制，实现进程同步和进程通信时必须的机制，消息队列，信号量。资源清单，该清单中列出了程序运行期间所需的全部的资源（除cpu外）。链接指针，给出了本进程所在队列的下一个进程PCB的地址
   4. 进程控制块的组织方式
      - 线性方式
      - 链接形式
      - 索引方式

## 3. 进程控制

- 操作系统内核
  1. 支撑功能
     - 中断处理, 各种程序进行中断处理, 是内核最基本的功能
     - 时钟管理, 是内核的基本功能, 在时间片轮转调度中, 当时间片用完, 便有时钟产生一个中断信号, 促使调度程序重新调度
     - 原语操作, 由若干条指令组成, 用于完成指定功能, 他们是原子操作
  2. 资源管理功能
     - 进程管理, 进程的调度和分配, 进程的创建和撤销
     - 存储器管理, 地址转换, 内存分配, 垃圾回收
     - 设备管理, 驱动管理
- 进程的创建
  1. 进程的层次结构, 创建进程的进程称为父进程, 而把被创建的进程称为子进程, 组成进程组
  2. 进程图
  3. 引起创建进程的事件
     - 用户登录
     - 作业调度
     - 提供服务
     - 应用请求
  4. 进程的创建
     - 申请空白PCB
     - 为新进程分配运行所需的资源
     - 初始化进程控制块
     - 如果进程就绪队列能够接纳新进程, 便将新进程插入就绪队列
- 进程的终止
  1. 引起进程终止
     - 正常结束
     - 异常结束
     - 外界干扰
  2. 所有进程终止过程
     - 根据被终止的进程的标识符, 从PCB集合中检索该进程的PCB, 读取状态
     - 若处于执行状态, 则终止给进程
     - 若还有子进程, 应立即终止
     - 回归资源
     - 从队列中移除队列
- 进程的阻塞和唤醒
  1. 引起进程阻塞和唤醒
     - 向系统请求共享资源失败
     - 等待操作完成
     - 数据尚未到达
     - 等待任务到达
  2. 进程阻塞过程
  3. 进程唤醒过程
- 进程的挂起与激活
  1. 进程的挂起, 保留内存状态
  2. 进程的激活, 还原状态

## 4. 进程同步
   - 进程同步的基本概念, 是对多个相关进程在执行次序上进行协调, 是并发执行的各进程之间按照一定的规则共享系统资源, 并相互合作
     1. 两种形式的制约关系
        - 间接相互制约关系, 打印机等
        - 直接相互制约关系, 合作任务, 数据流动
     2. 临界资源, 打印机, 磁带机等, 各进程应采用互斥方式, 实现资源的共享
     3. 临界区,无论是硬件资源还是软件资源,多个进程次序互斥的对他进行访问
     4. 同步机制应遵循的原则
        1. 空闲让进
        2. 忙则等待
        3. 优先等待
        4. 让权等待
   - 硬件同步机制,很多计算机提供了一些特殊的硬件指令,允许对一个字中的内容进行检测和修正
     1. 关中断,在进入锁测试之前关闭中断,,直到完成锁测试并上锁之后才能打开中断
     2. 利用test-and-set指令实现互斥
   - 信号量机制(生产消费者中的计数器)
     1. 整型信号量
     2. 记录型信号量,遵循了让权等待原则
     3. AND信号量,针对多个并发进程仅共享一个临界资源的情况
     4. 信号量集
        - Swait(S,d,d),此时信号量中只有一个信号量S,单允许他每次申请d个资源,当先有资源不足不予分配
        - Swait(S,1,1)互斥
        - Swait(s,1,0)可控开关
   - 信号量的应用
     1. 利用信号量实现进程互斥
     2. 利用信号量实现前驱关系
   - 管程机制,信号量机制会因不同操作使用不当导致系统死锁
     1. 管程的定义,系统中的各种硬件资源均可用数据结构抽象的描述其资源特性,即用少量信息和对该资源所执行的操作来表征该资源,尔忽略他们的内部结构和实现操作
        - 管城名称
        - 局部于管程的共享数据的结构说明
        - 对该数据结构进行操作的一组过程
        - 对局部于管程的共享数据设置初始值的语句
     2. 条件变量
   
   ---
   
## 5. 经典进程的同步问题

在多到程序环境下, 进程同步问题十分重要, 代表性是生产者消费者问题, 读者写者问题, 哲学家进餐问题
   - 生产者消费者问题
     1. 利用记录型信号量解决, MQ消息队列
     2. 利用AND信号量
     3. 利用管程
   
## 6. 进程通信
进程通信是进程之间的信息交流, 由于进程之间的互斥与同步, 需要在进程间交换一些信息, 但只能把他们称之为低级进程通信,1.效率低, 生产者每次只能向缓冲区放一个产品, 消费者每次只能消费一个产品,2,通信对用户不透明, os只为进程之间的通信提供了共享存储器
os的高级通信工具,1.使用方便, 隐藏内部细节,2.高效传输数据
1. 进程通信的类型
   1. 共享存储器系统
      1. 基于共享数据结构的通信方式
      2. 基于共享存储区的通信方式
   2. 管道通信系统
      1. 互斥, 读写等待
      2. 同步, 写入后等待读取, 读取后等待
      3. 确定对方是否存在
   3. 消息传递系统
      1. 直接通信方式, 利用os
      2. 间接通信方式, 通过共享中间实体完成消息通信
   4. 客户机/服务器系统
      1. 基于套接字socket
      2. 基于本地文件
      3. 基于网络型, web端口监听
   5. 远程过程调用和远程方法调用RPC, 谷歌GRPC

2. 消息传递通信的实现方式
   1. 直接消息传递系统
      1. 直接通信原语
         1. 对称寻址方式
         2. 非对称寻址方式
      2. 消息的格式  
      3. 进程的同步方式
      4. 通信链路
   2. 信箱通信
      1. 信箱结构
         1. 信箱头
         2. 信箱体
      2. 信箱通信原语
         1. 信箱创建和撤销
         2. 消息的发送和接受
      3. 信箱的类型
         1. 私用邮箱
         2. 公用邮箱
         3. 共享邮箱
3. 消息传递示例

## 7. 线程
1. 线程的引入<br />
如果说进程的引入是为了使多个程序能够并发执行, 以提高资源资源利用率和系统通途量, 引入线程就是为了减少在并发执行所付出的时空开销 
   1. 进程的两个基本属性
      - 进程是拥有资源的独立单位
      - 进程同时是可独立调度和分派的基本单位
   2. 程序并发执行所需付出的开销
      - 创建进程
      - 撤销进程
      - 进程切换
   3. 线程--作为调度和分派的基本单位
2. 线程和进程之间分比较
   1. 调度的基本单位
   2. 并发性
   3. 拥有资源
   4. 独立性
   5. 系统开销
   6. 支持多处理机系统
3. 线程的状态和线程控制块
   1. 线程运行的三种状态
      1. 执行
      2. 就绪
      3. 阻塞
   2. 线程控制会TCB
      1. 线程标识符
      2. 一组寄存器
      3. 线程运行状态
      4. 优先级
      5. 线程转有存储区
      6. 信号屏蔽
      7. 堆栈指针
   3. 多线程os中的属性

## 8.线程的实现
1. 线程的实现方式
   1. 内核支持线程KTS
      - 内核能够同时调度同一进程中的多个线程并行执行
      - 进程单一线程阻塞, 内核调度该进程其他线程占有处理器
      - 内核支持线程具有很小的数据结构和堆栈, 切换快, 开销小
      - 内核本身支持多线程
   2. 用户级线程
      - 线程不需要切换到内核空间
      - 调度算法为进程专用
      - 用户线程实现与os无关
      - 所有线程都会阻塞
      - 多线程不能利用处理机处理多重的有点
   3.  组合方式
       1.  多对一
       2.  一对一
       3.  多对多
2.  线程的实现